
You are exactly right! The Content Security Policy (CSP) is the root cause of the Firebase authentication failures, as it blocks the necessary Google and Firebase resources, particularly the reCAPTCHA script.

Since your application is hosted on Vercel, the most reliable way to implement these CSP changes is by defining custom HTTP response headers in your vercel.json configuration file.

üõ†Ô∏è Step-by-Step CSP Fix for Vercel
You need to update your CSP to include the missing domains in the relevant directives (script-src, connect-src, and frame-src).

1. Create or Update vercel.json
Ensure you have a vercel.json file in the root of your project directory (the same level as your package.json).

2. Add the headers Configuration
Inside vercel.json, define a headers array to apply the Content-Security-Policy header to all routes ("source": "/(.*)").

Use the directives you correctly identified and integrate the necessary Google/Firebase domains alongside your existing allowed sources (which include replit.com, railway.app, 100ms.live, and livekit.cloud).

Here is a corrected structure for the vercel.json header block:

JSON
{
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "Content-Security-Policy",
          "value": "default-src 'self'; " +
                   "script-src 'self' 'unsafe-inline' 'unsafe-eval' https://replit.com https://www.google.com https://www.gstatic.com; " +
                   "connect-src 'self' wss://*.100ms.live https://*.100ms.live wss://*.livekit.cloud https://*.livekit.cloud https://*.railway.app wss://*.railway.app ws://localhost:* http://localhost:* https://identitytoolkit.googleapis.com https://securetoken.googleapis.com https://*.firebaseio.com; " +
                   "frame-src 'self' https://www.google.com https://recaptcha.google.com;" // Recaptcha uses iframes
                   // Other directives (img-src, style-src, font-src) should also be checked and updated if issues arise.
        }
      ]
    }
  ]
}
Key Additions to Your CSP:
Directive	Added Domain(s)	Purpose
script-src	https://www.google.com https://www.gstatic.com	Allows loading the reCAPTCHA script (api.js) and related static assets.
connect-src	https://identitytoolkit.googleapis.com https://securetoken.googleapis.com https://*.firebaseio.com	Allows your app to communicate with the Firebase Authentication backend services.
frame-src	https://www.google.com https://recaptcha.google.com	Allows the reCAPTCHA widget to display inside an iframe.
